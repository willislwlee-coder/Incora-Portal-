<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Incora Customer Parts Portal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    /* (Styles unchanged from the previous version) */
  </style>
</head>
<body>
  <!-- LOGIN OVERLAY -->
  <div class="login-overlay" id="loginOverlay">
    <div class="login-card">
      <div class="brand" style="margin-bottom:10px;">
        <img src="incora-logo.png" alt="Incora" class="brand-logo-img" />
        <div>
          <div class="brand-text-main">INCORA</div>
          <div class="brand-text-sub">Customer access</div>
        </div>
      </div>
      <h2 class="login-title">Secure Parts Portal</h2>
      <p class="login-sub">
        Authorised users only. Enter your assigned username and password to continue.
      </p>

      <label class="login-label" for="usernameInput">Username</label>
      <input type="text" id="usernameInput" class="login-input" placeholder="e.g. user001" />

      <label class="login-label" for="passwordInput">Password</label>
      <input type="password" id="passwordInput" class="login-input" placeholder="Enter password" />

      <div class="login-error" id="loginError"></div>
      <div class="login-footer">
        <button id="loginBtn">Sign in</button>
        <div class="login-meta">
          Each customer will be assigned a unique account.<br/>
          Contact your Incora representative if you need access.
        </div>
      </div>
    </div>
  </div>

  <!-- MAIN APP -->
  <div class="app-wrapper" id="appRoot" style="display:none;">
    <div class="card">
      <div class="card-header">
        <div class="brand">
          <img src="incora-logo.png" alt="Incora" class="brand-logo-img" />
          <div>
            <div class="brand-text-main">INCORA</div>
            <div class="brand-text-sub">Customer Parts Portal</div>
          </div>
        </div>
        <div class="user-badge">
          <span id="userLabel">Logged in as: -</span>
          <button class="secondary" id="logoutBtn">Logout</button>
        </div>
      </div>

      <h1>Parts Availability &amp; Pricing Search</h1>
      <div class="subtitle">
        Enter one or more part numbers to check current sell price and on-hand quantity.
      </div>

      <div class="search-section">
        <label for="partInput">Part numbers</label>
        <div class="search-row">
          <textarea id="partInput" placeholder="e.g. AS20624, AS52761&#10;You can paste from Excel or enter one per line."></textarea>
          <div class="button-row">
            <button id="searchBtn"><span>Search</span></button>
            <button type="button" class="secondary" id="clearBtn">Clear</button>
          </div>
        </div>
        <div class="hint">
          • Separate part numbers by commas, spaces, or new lines. <br/>
          • Search is not case-sensitive and matches exact part numbers.
        </div>
        <div class="status-bar">
          <span>
            <span id="statusDot" class="status-dot"></span>
            <span id="statusText">Loading data...</span>
          </span>
          <span id="summaryText"></span>
        </div>
      </div>

      <table id="resultsTable" style="display:none;">
        <thead>
          <tr>
            <th>Part Number</th>
            <th>Quantity Available</th>
            <th>Sell Price</th>
            <th>Certificate Available</th>
          </tr>
        </thead>
        <tbody id="resultsBody"></tbody>
      </table>
      <div class="no-results" id="noResults" style="display:none;">
        No results yet. Enter part numbers above and click <strong>Search</strong>.
      </div>

      <div class="footer-note">
        <div>
          <strong>Notes</strong><br/>
          Data shown is based on internal inventory and subject to confirmation at time of order.
        </div>
        <div class="footer-right">
          &copy; Incora. All rights reserved.
        </div>
      </div>
    </div>
  </div>

  <script>
  const AUTH_ENDPOINT = "https://script.google.com/macros/s/AKfycbyVfU0GpnO-ZOOvX4T0rvE2meP8q1PpuJSktGNvnI53J9hYNyfRplraf4cNd3MRXHxJ/exec";
  const LOG_ENDPOINT = "";

  let currentUser = null;

  const loginOverlay = document.getElementById("loginOverlay");
  const appRoot = document.getElementById("appRoot");
  const loginBtn = document.getElementById("loginBtn");
  const usernameInput = document.getElementById("usernameInput");
  const passwordInput = document.getElementById("passwordInput");
  const loginError = document.getElementById("loginError");
  const userLabel = document.getElementById("userLabel");
  const logoutBtn = document.getElementById("logoutBtn");

  function showApp(username) {
    currentUser = username;
    userLabel.textContent = "Logged in as: " + username;
    loginOverlay.style.display = "none";
    appRoot.style.display = "block";
  }

  function showLogin() {
    appRoot.style.display = "none";
    loginOverlay.style.display = "flex";
    usernameInput.value = "";
    passwordInput.value = "";
    loginError.textContent = "";
  }

  async function attemptLogin() {
    const u = usernameInput.value.trim();
    const p = passwordInput.value.trim();

    if (!u || !p) {
      loginError.textContent = "Username and password are required.";
      return;
    }

    loginError.textContent = "Checking...";

    try {
      const body = new URLSearchParams({ username: u, password: p }).toString();

      const response = await fetch(AUTH_ENDPOINT, {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body
      });

      const result = await response.json();

      if (result.success) {
        try { localStorage.setItem("incora_current_user", u); } catch (e) {}
        showApp(u);
      } else {
        loginError.textContent = "Invalid username or password.";
      }
    } catch (err) {
      loginError.textContent = "Login service unavailable.";
    }
  }

  loginBtn.addEventListener("click", attemptLogin);
  passwordInput.addEventListener("keypress", function (e) {
    if (e.key === "Enter") {
      e.preventDefault();
      attemptLogin();
    }
  });

  logoutBtn.addEventListener("click", function () {
    try { localStorage.removeItem("incora_current_user"); } catch (e) {}
    showLogin();
  });
  </script>
</body>
</html>
